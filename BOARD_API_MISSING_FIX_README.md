# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "Cannot apply board update: excalidrawAPI or boardData missing"

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
[Warning] ‚ö†Ô∏è Cannot apply board update: excalidrawAPI or boardData missing
```

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –∫–æ–≥–¥–∞:
1. **Excalidraw API –µ—â–µ –Ω–µ –±—ã–ª –≥–æ—Ç–æ–≤** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **boardData –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª** –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
3. **Race condition** –º–µ–∂–¥—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π API –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ–º WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π

## –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã
1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: Excalidraw API –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–æ WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ä–∞–Ω—å—à–µ
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—á–µ—Ä–µ–¥–∏**: –ù–µ –±—ã–ª–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ boardData –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `pendingBoardUpdates`** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ API
- ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏** (–º–∞–∫—Å–∏–º—É–º 10, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5)
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–æ—Å–∫–∏** –Ω–∞–¥ –æ–±—ã—á–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏

### 2. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `applyBoardUpdate`
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ API** –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å** –µ—Å–ª–∏ API –Ω–µ –≥–æ—Ç–æ–≤
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** boardData
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `processPendingBoardUpdates`
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** –∫–æ–≥–¥–∞ API —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–æ—Å–∫–∏** –Ω–∞–¥ –æ–±—ã—á–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- ‚úÖ **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ** –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 4. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `applyBoardState`
- ‚úÖ **–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏** –∫–∞–∫ –≤ `applyBoardUpdate`
- ‚úÖ **–ü–æ–º–µ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–æ—Å–∫–∏** —Ñ–ª–∞–≥–æ–º `isState: true`
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π API
- ‚úÖ **–í—ã–∑–æ–≤ `processPendingBoardUpdates()`** –≤ `onReady` callback
- ‚úÖ **–í—ã–∑–æ–≤ `processPendingBoardUpdates()`** –≤ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–º callback
- ‚úÖ **–ó–∞–¥–µ—Ä–∂–∫–∞ 100ms** –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ API

### 6. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –Ω–∞–ª–∏—á–∏—è `boardData` –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- ‚úÖ **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: API –≥–æ—Ç–æ–≤
1. **–ü—Ä–∏—Ö–æ–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Üí `applyBoardUpdate()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
2. **API –≥–æ—Ç–æ–≤** ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É
3. **–õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—Ö** ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: API –Ω–µ –≥–æ—Ç–æ–≤
1. **–ü—Ä–∏—Ö–æ–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Üí `applyBoardUpdate()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
2. **API –Ω–µ –≥–æ—Ç–æ–≤** ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
3. **API —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º** ‚Üí `processPendingBoardUpdates()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
4. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—á–µ—Ä–µ–¥—å** ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–∞–º–æ–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å–∫–∏
1. **–ü—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å–∫–∏** ‚Üí `applyBoardState()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
2. **–ï—Å–ª–∏ API –Ω–µ –≥–æ—Ç–æ–≤** ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å —Å —Ñ–ª–∞–≥–æ–º `isState: true`
3. **–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—á–µ—Ä–µ–¥–∏** ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å–∫–∏ –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
4. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ** ‚Üí –¥–æ—Å–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "API missing":
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è** –µ—Å–ª–∏ API –Ω–µ –≥–æ—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ** –∫–æ–≥–¥–∞ API –≥–æ—Ç–æ–≤
- **–ù–∏–∫–∞–∫–∏—Ö –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**

### ‚úÖ –ù–∞–¥–µ–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- **–í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è** –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- **–°–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ—Å–∫–∏ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç** –Ω–∞–¥ –æ–±—ã—á–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞:
- **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –¥–∞–Ω–Ω—ã–º–∏
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –æ—á–µ—Ä–µ–¥–∏**

## –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- ‚úÖ `üìã API not ready, queuing board update...`
- ‚úÖ `üìã Processing X pending board updates...`
- ‚úÖ `üìã Found pending board state, applying...`
- ‚úÖ `‚úÖ Board update applied successfully with X elements`

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
- ‚ö†Ô∏è `‚ö†Ô∏è Board update received without boardData`
- ‚ö†Ô∏è `‚ö†Ô∏è Board state received without boardData`

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `src/main/resources/templates/excalidraw-board.html`

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
–û—à–∏–±–∫–∞ "Cannot apply board update: excalidrawAPI or boardData missing" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ API –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤.
