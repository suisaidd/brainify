# Professional Board - Исправления и инструкции

## Исправленные проблемы

### 1. Инициализация модулей
- **Проблема**: Модули не создавались как экземпляры классов
- **Решение**: Добавлено правильное создание экземпляров всех модулей в `initModules()`

### 2. Обработчики событий
- **Проблема**: Кнопки не работали из-за неправильных селекторов
- **Решение**: Исправлены селекторы и добавлены правильные обработчики событий

### 3. Рендерер
- **Проблема**: WebGL рендерер не был полностью реализован
- **Решение**: Улучшен Canvas2D рендерер и добавлена поддержка всех типов объектов

### 4. Инструменты
- **Проблема**: Инструменты не работали корректно
- **Решение**: Исправлена передача событий мыши в инструменты

### 5. Интерфейс
- **Проблема**: Отсутствовали некоторые элементы интерфейса
- **Решение**: Добавлена палитра цветов и исправлены стили

## Структура файлов

```
src/main/resources/static/js/
├── professional-board-core.js      # Основной класс доски
├── professional-board-renderer.js  # Рендереры (WebGL/Canvas2D)
├── professional-board-tools.js     # Инструменты рисования
├── professional-board-modules.js   # Дополнительные модули
└── professional-board.js           # Основной файл инициализации

src/main/resources/static/css/
└── professional-board-new.css      # Стили интерфейса

src/main/resources/templates/
└── professional-board.html         # Основной HTML шаблон
```

## Использование

### 1. Основная доска
Откройте `/professional-board` для использования основной доски с полным функционалом.

### 2. Тестовая доска
Откройте `/test-simple-board.html` для тестирования базового функционала.

### 3. Программное использование

```javascript
// Создание доски
const board = new ProfessionalBoard('canvasId', {
    renderer: 'canvas2d',        // или 'webgl'
    width: 2000,
    height: 2000,
    backgroundColor: '#ffffff',
    gridEnabled: true,
    gridSize: 20
});

// Установка инструмента
board.modules.tools.setActiveTool('pen');

// Изменение цвета
board.state.selectedColor = '#FF0000';

// Изменение размера кисти
board.state.brushSize = 5;

// Очистка доски
board.clear();

// Экспорт
board.exportAs('png').then(dataURL => {
    // Обработка экспорта
});
```

## Доступные инструменты

1. **Ручка (pen)** - Основной инструмент рисования
2. **Маркер (highlighter)** - Полупрозрачное рисование
3. **Ластик (eraser)** - Удаление объектов
4. **Текст (text)** - Добавление текста
5. **Фигуры (shape)** - Рисование геометрических фигур
6. **Выбор (select)** - Выбор и перемещение объектов

## Горячие клавиши

- **Ctrl+Z** - Отменить
- **Ctrl+Y** - Повторить
- **Delete** - Удалить выбранные объекты
- **Space** - Переключиться на инструмент перемещения
- **Ctrl+S** - Сохранить

## Модули

### 1. ToolsManager
Управляет инструментами рисования и их переключением.

### 2. LayersManager
Управляет слоями доски.

### 3. HistoryManager
Управляет историей операций (отмена/повтор).

### 4. ExportManager
Обеспечивает экспорт в различные форматы (PNG, JPEG, SVG, PDF, JSON).

### 5. CollaborationManager
Обеспечивает совместную работу в реальном времени.

### 6. FormulaManager
Поддерживает математические формулы (LaTeX).

### 7. RecognitionManager
Распознавание рукописного текста и фигур.

## Совместная работа

Для включения совместной работы:

1. Убедитесь, что WebSocket сервер настроен
2. Передайте правильные параметры в `CollaborationManager.connect()`
3. Настройте обработку сообщений на сервере

## Производительность

- **Canvas2D**: Подходит для большинства случаев, хорошая совместимость
- **WebGL**: Максимальная производительность, требует поддержки браузером

## Совместимость

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## Известные ограничения

1. WebGL рендерер не полностью реализован для всех типов объектов
2. Совместная работа требует настройки WebSocket сервера
3. Распознавание формул требует загрузки KaTeX

## Отладка

Для отладки используйте консоль браузера. Все основные события логируются:

```javascript
// Включение подробного логирования
board.on('drawStart', (stroke) => console.log('Начало рисования:', stroke));
board.on('drawEnd', (stroke) => console.log('Конец рисования:', stroke));
board.on('toolChanged', (tool) => console.log('Инструмент изменен:', tool));
```

## Обновления

При обновлении доски:

1. Очистите кэш браузера
2. Проверьте совместимость с существующими данными
3. Обновите CSS стили при необходимости

## Поддержка

При возникновении проблем:

1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что все файлы загружены корректно
3. Проверьте совместимость браузера
4. Используйте тестовую доску для изоляции проблем
