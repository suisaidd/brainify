# Руководство по тестированию синхронизации доски

## Проблемы, которые были исправлены:

1. **Неправильное сохранение типов операций** - операции сохранялись как `draw_data` вместо `start`, `draw`, `end`
2. **Отсутствие отладочной информации** - добавлены логи для отслеживания проблем
3. **Неправильное восстановление состояния** - исправлена логика восстановления из БД
4. **Проблемы с WebSocket аутентификацией** - улучшена обработка пользователей

## Как протестировать:

### 1. Тест API доски
Откройте: `http://localhost:8082/test-board-api`

Этот инструмент позволяет:
- Создавать тестовые операции рисования
- Проверять состояние доски
- Просматривать все операции в БД
- Очищать доску

### 2. Тест синхронизации доски
Откройте: `http://localhost:8082/test-board-sync`

Этот инструмент позволяет:
- Подключиться к WebSocket
- Рисовать на доске
- Проверить синхронизацию между вкладками

### 3. Тест онлайн урока
Откройте: `http://localhost:8082/online-lesson?lessonId=1`

## Проверка базы данных:

```sql
-- Проверить количество операций
SELECT COUNT(*) FROM board_operations;

-- Посмотреть последние операции
SELECT lesson_id, operation_type, x_coordinate, y_coordinate, user_name, sequence_number 
FROM board_operations 
ORDER BY timestamp DESC LIMIT 10;

-- Проверить операции для конкретного урока
SELECT * FROM board_operations WHERE lesson_id = 1 ORDER BY sequence_number;
```

## Ожидаемое поведение:

1. **При рисовании** - операции должны сохраняться в БД с правильными типами (`start`, `draw`, `end`)
2. **При подключении нового пользователя** - доска должна восстановиться из БД
3. **При обновлении страницы** - содержимое доски должно сохраниться
4. **Синхронизация в реальном времени** - все пользователи должны видеть рисование друг друга

## Отладочная информация:

В консоли сервера вы увидите логи:
- `=== Получение состояния доски для урока X ===`
- `Операции для урока X существуют: true/false`
- `Найдено операций: N`
- `Операция: start x=100 y=100 user=Имя seq=1`

В консоли браузера вы увидите логи:
- `Получено состояние доски: {...}`
- `Восстанавливаем N операций`
- `Восстанавливаем операцию 1: {...}`

## Если проблемы остаются:

1. Проверьте, что таблица `board_operations` существует и содержит данные
2. Проверьте логи сервера на наличие ошибок
3. Проверьте консоль браузера на наличие ошибок JavaScript
4. Убедитесь, что WebSocket подключение работает
5. Проверьте, что операции сохраняются с правильными типами

